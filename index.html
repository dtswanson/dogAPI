<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>API Demo: Asynchronous Data</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 40px 20px; }
        .demo-card { background: white; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); padding: 30px; max-width: 700px; margin: 0 auto; }
        h1 { font-weight: 700; color: #1a1a1b; margin-top: 0; }
        
        /* Image Styling */
        .image-container { 
            background: #e9ecef; border-radius: 8px; overflow: hidden; 
            margin: 20px 0; min-height: 350px; display: flex; align-items: center; justify-content: center;
        }
        .image-container img { width: 100%; height: 400px; object-fit: cover; }
        
        /* Fact Styling */
        .fact-box { 
            background: #fff8e1; border-left: 5px solid #ffc107; 
            padding: 15px; font-size: 1.1em; margin-bottom: 20px; min-height: 60px;
        }
        
        /* Debugger Styling */
        .debug-panel { 
            background: #272822; color: #f8f8f2; padding: 15px; 
            border-radius: 5px; font-family: monospace; font-size: 12px; text-align: left; overflow-x: auto;
        }
        .status-tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-bottom: 10px; }
        .status-success { background: #d4edda; color: #155724; }
    </style>
</head>
<body>

<div class="demo-card text-center">
    <h1>Dog API Explorer</h1>
    <p class="text-muted">Demonstrating multiple concurrent AJAX requests</p>
    
    <button class="btn btn-primary btn-lg get-dog" id="fetchBtn">
        <span class="glyphicon glyphicon-refresh"></span> Fetch New Data
    </button>

    <div class="image-container" id="imgBox">
        <p class="text-muted">Dog image will appear here</p>
    </div>

    <div class="fact-box text-left" id="factBox">
        Click the button to fetch a random fact!
    </div>

    <div class="text-left">
        <span class="status-tag status-success" id="status">Ready</span>
        <div class="debug-panel">
            <div style="color: #66d9ef;">// Raw JSON Response Header</div>
            <span id="debug-text">Waiting for request...</span>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
    function updateUI(message, isError = false) {
        const status = $('#status');
        status.text(message);
        status.css('background', isError ? '#f8d7da' : '#d4edda');
        status.css('color', isError ? '#721c24' : '#155724');
    }

    function fetchData() {
        // UI Reset
        $('#fetchBtn').prop('disabled', true).text('Loading...');
        $('#debug-text').text('Fetching from servers...');
        updateUI('Processing...');

        // Call 1: Dog CEO (Images)
        const dogRequest = $.getJSON("https://dog.ceo/api/breeds/image/random");
        
        // Call 2: MeowFacts (Stable, supports CORS, great for demos)
        const factRequest = $.getJSON("https://meowfacts.herokuapp.com/");

        // Use $.when to manage multiple asynchronous streams
        $.when(dogRequest, factRequest)
            .done(function(dogData, factData) {
                // dogData and factData are arrays: [data, status, jqXHR]
                
                // Update Image
                const imgUrl = dogData[0].message;
                $('#imgBox').html(`<img src="${imgUrl}" class="img-responsive">`);

                // Update Fact (Path: data.data[0])
                const factText = factData[0].data[0];
                $('#factBox').html(`<strong>Fact:</strong> ${factText}`);

                // Update Debugger
                $('#debug-text').text(JSON.stringify(dogData[0], null, 2));
                updateUI('Fetch Successful');
            })
            .fail(function() {
                updateUI('API Error!', true);
                $('#factBox').text('Failed to load data from one of the sources.');
            })
            .always(function() {
                $('#fetchBtn').prop('disabled', false).html('<span class="glyphicon glyphicon-refresh"></span> Fetch New Data');
            });
    }

    $('#fetchBtn').on('click', fetchData);
</script>

</body>
</html>
